<img src="nmap-logo.jpeg">

# NMAP
## O que é nmap?

É uma ferramenta de segurança de código aberto para exploração, varredura, auditoria e segurança de rede. Tem muitas opções que o tornam uma ferramenta eficiênte para scan, enumeração e até mesmo levantamento de vulnerabilidades.

Cenário de lab:

Uma vm com Kali linux.
IP: 192.168.10.130

Uma vm com metasploitable
IP: 192.168.10.100

### 1 - Scan de um host (IPV4)

Diante dese cenário, vamos rodar o seguinte comando:

    nmap 192.168.10.100

O resultado desse comando estará conforme a figura abaixo:

<img src="nmap1.png">

Podemos listar apenas as primeiras dez portas com o comando:

    nmap --top-ports 10 192.168.10.100

Observe o resultado:

<img src="nmap2.png">

## 2 - Scan de uma subrede

    nmap -sP 192.168.10.0/24

O resultado pode ser visto abaixo

<img src="nmap3.png">

Como essa rede somente tem dois ips, ele encontrou somente esses. Se houvessem mais ips, ele os listaria no resultado.

## 3 - Detectando versão do Sistema Operacional

    nmap -A 192.168.10.100

Observe os prints do resultado

<img src="nmap4.png">
<img src="nmap5.png">
<img src="nmap6.png">

Coloque o -v na frente para executar no modo verbose, e você poder ver toda a consulta feita.

    nmap -A -v 192.168.10.100

## Outros parametros do nmap

- -sn - Detecção de hosts vivos
- -sT - TCP Connect
- -sS - SYN Scan/ Half Ipen
- -sV - Descobrir versões dos serviços
- -sU - UDP Scan
- -Pn - Ignora descoberra de hosts vivos
- -O - Faz detecção de Sistema Operacional
- -A - Descobre detalhes do serviço e do Sistema Operacional
- -p- - Varre todas as portas (65535)
- -sF - FIN Scan (Envia flag FIN)
- -sN - NULL Scan (não envia flag FIN)
- -sX - XMAS Scan
- -f - Fragmenta os pacotes
- -p - Defini a porta
- --open - Só mostra portas abertas
- -oN - Salva arquivo em formato normal
- -oX - Salva arquivo em forma XML
- -oG - Salva arquivo em formato para grep

## NSE

O nmap possuí um recurso que o deixa ainda mais util fazendo dele uma ferramenta indispensável para todo bom pentesting. Esse recurso é o NSE (Nmap Script Engine )

Com esse recurso é possível não somente realizar scan de portas, mas scan de vulnerabilidades, e em alguns casos ataque de Brute force.

Para checar todos os scritps, basta ir ao diretório dando o comando:

    #cd /usr/share/nmap/scripts/

    #ls (para listar todo conteúdo da pasta)

São centenas de scripts, 600 em média.

No exemplo abaixo estamos executando um ataque brute force para descobrir credenciais de acesso SSH
    
    nmap --script=ssh* 192.168.10.100 -p22

Conforme abaixo:

<img src="nmap7.png">

Conforme pode ser visto no resultado abaixo, colado em parte, podemos ver que descobriu uma credencial:

<img src="nmap8.png">

Descoberto credenciais:

    user:user

Podemos fazer acesso ssh ao servidor 192.168.10.100 e validar as credenciais.

    ssh user@192.168.10.100
    password: user

<img src="nmap9.png">

Login bem sucedido!!

### Scan de outras Vulnerabilidades

Vamos agora fazer um scan na porta 80 utilizando os scripts de ftp. Para isso daremos o seguinte comando:

    nmap --script=ftp* -Pn -v 192.168.10.100 -p21

<img src="nmap10.png">

O scan encontrou vulneravilidades no serviço de ftp:

<img src="nmap11.png">

Podemos também realizar uma análise geral de vulnerabilidades no host. Para isso daremos o comando:

    nmap -v -Pn --scritp-vuln 192.168.10.100

<img src="nmap12.png">

Você vai observer que o status do scan será bem extenso.

<img src="nmap13.png">

Muitas vulnerabilidades podem ser explorados. Ftp, SSL, Sql Injection, e assim por diante..